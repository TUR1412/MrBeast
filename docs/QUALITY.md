# 质量与审查（原子级）

本文件记录本项目的“原子级”交付标准，方便你二次迭代时保持一致的体验与稳健性。

---

## 1) 交互体验

### 1.1 反馈必须“讲人话”

- 禁止在主界面裸露 JSON、错误堆栈、原始日志
- 表单/交互反馈统一走 Toast（`#toast-root`）

### 1.2 按钮必须有物理反馈

- `:hover` 有上浮/高光
- `:active` 有缩放（例如 `scale(0.97)`）

---

## 2) 可访问性（A11y）

### 2.1 键盘可用

- 提供 Skip Link：`.skip-link`
- 所有可交互元素有清晰的 `:focus-visible` 描边

### 2.2 移动端菜单无“幽灵焦点”

- 在移动端（`max-width: 768px`）菜单关闭时：
  - 导航列表启用 `aria-hidden="true"`
  - 导航列表启用 `inert`（若浏览器支持）

这样读屏与键盘焦点不会“穿过遮罩点到背后的链接”。

---

## 3) 动效与降级

### 3.1 Reduced Motion

- 侦测 `prefers-reduced-motion: reduce`
- 在 Reduced Motion 场景：
  - 粒子动效不启动
  - Confetti 不触发
  - 轮播不自动播放
  - 滚动入场不做位移动画

### 3.1.1 手动动效模式（覆盖系统偏好）

页面右下角提供 `动效：自动/关/开` 三档开关（持久化），优先级为：

1. **关**：强制减少动效
2. **开**：强制启用动效
3. **自动**：跟随系统 `prefers-reduced-motion`

实现要点：

- 偏好写入 `localStorage`：`mrbeast_motion_mode_v1`
- 在生效为“减少动效”时，`<html>` 会写入 `data-motion="reduce"`，用于 CSS 侧降级/覆盖（例如关闭平滑滚动、隐藏粒子画布等）

### 3.2 默认可见（避免 JS 救场）

滚动入场动画采用“默认可见 + JS 仅位移”的策略：

- 没有 JS：内容照常可见
- 有 JS：添加轻微位移，进入视口后归位

---

## 4) 性能与稳定性

### 4.1 粒子连线避免 O(n²)

连线逻辑采用“网格近邻搜索”，避免在高分辨率大屏下每帧做全量两两距离计算。

### 4.2 视口外跳过渲染

在支持的浏览器上启用 `content-visibility: auto`，让视口外大区块跳过布局与绘制，降低电量消耗。

### 4.3 Save-Data / 弱网降级

若浏览器启用了数据节省（`Save-Data`）或处于 `2g / slow-2g`：

- 粒子数量与连线距离自动下调
- 保持视觉氛围，但避免“为动效耗尽流量/电量”

### 4.4 重型动效的加载优先级

原则：**优先交互与可读性，动效延后**。

- 导航/滚动入场/轮播属于“结构与反馈”，优先初始化
- 粒子/Spotlight/光标跟随属于“氛围增强”，使用 `requestIdleCallback`（或 `setTimeout`）延后初始化

---

## 5) 缓存穿透（Cache Busting）

每次修改核心逻辑/样式后，必须更新 `index.html` 中静态资源版本号：

```html
<link rel="stylesheet" href="assets/styles.css?v=20251218-01">
<script src="assets/app.js?v=20251218-01" defer></script>
```

目的：避免浏览器缓存导致“改了但不生效”的幽灵问题。

---

## 6) 无 JS 退化（No-JS Fallback）

- **移动端导航**：无 JS 时不显示汉堡按钮，导航链接直接可见（可键盘访问）
- **轮播**：无 JS 时退化为列表展示，并隐藏无效控制按钮
